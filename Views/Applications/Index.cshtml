@model IEnumerable<Application>

@{
    ViewData["Title"] = "Başvurular";
    var currentPage = (int)ViewData["CurrentPage"];
    var totalPages = (int)ViewData["TotalPages"];
}

    <div class="container-fluid mt-4">
        <div class="row mb-4" id="statsCards">
            <div class="col-md-2">
                <div class="card text-center stats-card">
                    <div class="card-body">
                        <i class="bi bi-bar-chart-fill text-secondary fs-2"></i>
                        <h3 class="mt-2 mb-0" id="statTotal">0</h3>
                        <p class="text-muted mb-0">Toplam</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center stats-card">
                    <div class="card-body">
                        <i class="bi bi-clock-fill text-primary fs-2"></i>
                        <h3 class="mt-2 mb-0 text-primary" id="statApplied">0</h3>
                        <p class="text-muted mb-0">Başvuruldu</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center stats-card">
                    <div class="card-body">
                        <i class="bi bi-calendar-event-fill text-warning fs-2"></i>
                        <h3 class="mt-2 mb-0 text-warning" id="statInterview">0</h3>
                        <p class="text-muted mb-0">Mülakat</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center stats-card">
                    <div class="card-body">
                        <i class="bi bi-x-circle-fill text-danger fs-2"></i>
                        <h3 class="mt-2 mb-0 text-danger" id="statRejected">0</h3>
                        <p class="text-muted mb-0">Red</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center stats-card">
                    <div class="card-body">
                        <i class="bi bi-check-circle-fill text-success fs-2"></i>
                        <h3 class="mt-2 mb-0 text-success" id="statAccepted">0</h3>
                        <p class="text-muted mb-0">Kabul</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <form asp-action="Index" method="get" class="row g-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                            <input type="text" class="form-control" name="searchTerm"
                                   value="@ViewData["CurrentSearch"]"
                                   placeholder="Firma, pozisyon veya konum ara...">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="filterStatus">
                            <option value="">Tüm Durumlar</option>
                            <option value="Başvuruldu" selected="@(ViewData["CurrentFilter"]?.ToString() == "Başvuruldu")">Başvuruldu</option>
                            <option value="Mülakat" selected="@(ViewData["CurrentFilter"]?.ToString() == "Mülakat")">Mülakat</option>
                            <option value="Red" selected="@(ViewData["CurrentFilter"]?.ToString() == "Red")">Red</option>
                            <option value="Kabul" selected="@(ViewData["CurrentFilter"]?.ToString() == "Kabul")">Kabul</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-funnel-fill"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th><i class="bi bi-building me-2"></i>Firma</th>
                                <th><i class="bi bi-briefcase me-2"></i>Pozisyon</th>
                                <th><i class="bi bi-geo-alt me-2"></i>Konum</th>
                                <th><i class="bi bi-currency-dollar me-2"></i>Maaş</th>
                                <th><i class="bi bi-calendar me-2"></i>Tarih</th>
                                <th><i class="bi bi-flag me-2"></i>Durum</th>
                                <th class="text-center">İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (!Model.Any())
                            {
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <i class="bi bi-inbox fs-1 text-muted"></i>
                                        <p class="text-muted mt-2">Henüz başvuru bulunmuyor</p>
                                        <a asp-action="Create" class="btn btn-primary">
                                            <i class="bi bi-plus-circle me-2"></i>İlk Başvuruyu Ekle
                                        </a>
                                    </td>
                                </tr>
                            }
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td><strong>@item.CompanyName</strong></td>
                                    <td>@item.Position</td>
                                    <td>@item.Location</td>
                                    <td>@(item.Salary ?? "-")</td>
                                    <td>@item.ApplicationDate.ToString("dd.MM.yyyy")</td>
                                    <td>
                                        @{
                                            var badgeClass = item.Status switch
                                            {
                                                ApplicationStatus.Başvuruldu => "bg-primary",
                                                ApplicationStatus.Mülakat => "bg-warning text-dark",
                                                ApplicationStatus.Red => "bg-danger",
                                                ApplicationStatus.Kabul => "bg-success",
                                                _ => "bg-secondary"
                                            };
                                        }
                                        <span class="badge @badgeClass">@item.Status</span>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group" role="group">
                                            <a asp-action="Details" asp-route-id="@item.Id"
                                               class="btn btn-sm btn-outline-info" title="Görüntüle">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a asp-action="Edit" asp-route-id="@item.Id"
                                               class="btn btn-sm btn-outline-warning" title="Düzenle">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <a asp-action="Delete" asp-route-id="@item.Id"
                                               class="btn btn-sm btn-outline-danger" title="Sil">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (totalPages > 1)
                {
                    <nav aria-label="Sayfa navigasyonu">
                        <ul class="pagination justify-content-center mt-4">
                            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                                <a class="page-link" asp-action="Index"
                                   asp-route-page="@(currentPage - 1)"
                                   asp-route-searchTerm="@ViewData["CurrentSearch"]"
                                   asp-route-filterStatus="@ViewData["CurrentFilter"]">
                                    Önceki
                                </a>
                            </li>

                            @for (var i = 1; i <= totalPages; i++)
                            {
                                <li class="page-item @(i == currentPage ? "active" : "")">
                                    <a class="page-link" asp-action="Index"
                                       asp-route-page="@i"
                                       asp-route-searchTerm="@ViewData["CurrentSearch"]"
                                       asp-route-filterStatus="@ViewData["CurrentFilter"]">
                                        @i
                                    </a>
                                </li>
                            }

                            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                                <a class="page-link" asp-action="Index"
                                   asp-route-page="@(currentPage + 1)"
                                   asp-route-searchTerm="@ViewData["CurrentSearch"]"
                                   asp-route-filterStatus="@ViewData["CurrentFilter"]">
                                    Sonraki
                                </a>
                            </li>
                        </ul>
                    </nav>
                }
            </div>
        </div>
    </div>

@section Scripts {
        <script>
            fetch('/Applications/GetStats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('statTotal').textContent = data.total;
                    document.getElementById('statApplied').textContent = data.applied;
                    document.getElementById('statInterview').textContent = data.interview;
                    document.getElementById('statRejected').textContent = data.rejected;
                    document.getElementById('statAccepted').textContent = data.accepted;
                });
        </script>
}
